import{h as p,ay as re,ad as F,y as g,o as k,k as K,ac as ne,r as b,_ as ue,A as ce,x as ie,w as O,u as S,a8 as ae,Y as de,V as j,aF as fe}from"./index-CHNotA-O.js";function Oe(e){return e===void 0}const le=(e,o)=>{if(!p)return!1;const t={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(o)],s=re(e,t);return["scroll","auto","overlay"].some(r=>s.includes(r))},Ie=(e,o)=>{if(!p)return;let t=e;for(;t;){if([window,document,document.documentElement].includes(t))return window;if(le(t,o))return t;t=t.parentNode}return t};let _;const De=e=>{var o;if(!p)return 0;if(_!==void 0)return _;const t=document.createElement("div");t.className=`${e}-scrollbar__wrap`,t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const s=t.offsetWidth;t.style.overflow="scroll";const r=document.createElement("div");r.style.width="100%",t.appendChild(r);const c=r.offsetWidth;return(o=t.parentNode)==null||o.removeChild(t),_=s-c,_};var Ee=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(Ee||{});const I=e=>{const o=F(e)?e:[e],t=[];return o.forEach(s=>{var r;F(s)?t.push(...I(s)):g(s)&&F(s.children)?t.push(...I(s.children)):(t.push(s),g(s)&&((r=s.component)!=null&&r.subTree)&&t.push(...I(s.component.subTree)))}),t};let v=[];const q=e=>{const o=e;o.key===ne.esc&&v.forEach(t=>t(o))},ve=e=>{k(()=>{v.length===0&&document.addEventListener("keydown",q),p&&v.push(e)}),K(()=>{v=v.filter(o=>o!==e),v.length===0&&p&&document.removeEventListener("keydown",q)})},D="focus-trap.focus-after-trapped",U="focus-trap.focus-after-released",pe="focus-trap.focusout-prevented",X={cancelable:!0,bubbles:!1},Te={cancelable:!0,bubbles:!1},J="focusAfterTrapped",z="focusAfterReleased",me=Symbol("elFocusTrap"),P=b(),N=b(0),h=b(0);let y=0;const oe=e=>{const o=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)o.push(t.currentNode);return o},Q=(e,o)=>{for(const t of e)if(!Se(t,o))return t},Se=(e,o)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(o&&e===o)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},_e=e=>{const o=oe(e),t=Q(o,e),s=Q(o.reverse(),e);return[t,s]},ye=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,o)=>{if(e&&e.focus){const t=document.activeElement;e.focus({preventScroll:!0}),h.value=window.performance.now(),e!==t&&ye(e)&&o&&e.select()}};function Z(e,o){const t=[...e],s=e.indexOf(o);return s!==-1&&t.splice(s,1),t}const we=()=>{let e=[];return{push:s=>{const r=e[0];r&&s!==r&&r.pause(),e=Z(e,s),e.unshift(s)},remove:s=>{var r,c;e=Z(e,s),(c=(r=e[0])==null?void 0:r.resume)==null||c.call(r)}}},Le=(e,o=!1)=>{const t=document.activeElement;for(const s of e)if(l(s,o),document.activeElement!==t)return},ee=we(),be=()=>N.value>h.value,w=()=>{P.value="pointer",N.value=window.performance.now()},te=()=>{P.value="keyboard",N.value=window.performance.now()},Ne=()=>(k(()=>{y===0&&(document.addEventListener("mousedown",w),document.addEventListener("touchstart",w),document.addEventListener("keydown",te)),y++}),K(()=>{y--,y<=0&&(document.removeEventListener("mousedown",w),document.removeEventListener("touchstart",w),document.removeEventListener("keydown",te))}),{focusReason:P,lastUserFocusTimestamp:N,lastAutomatedFocusTimestamp:h}),L=e=>new CustomEvent(pe,{...Te,detail:e}),Ce=ce({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[J,z,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:o}){const t=b();let s,r;const{focusReason:c}=Ne();ve(n=>{e.trapped&&!E.paused&&o("release-requested",n)});const E={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},T=n=>{if(!e.loop&&!e.trapped||E.paused)return;const{key:u,altKey:i,ctrlKey:a,metaKey:d,currentTarget:W,shiftKey:G}=n,{loop:$}=e,se=u===ne.tab&&!i&&!a&&!d,m=document.activeElement;if(se&&m){const C=W,[A,R]=_e(C);if(A&&R){if(!G&&m===R){const f=L({focusReason:c.value});o("focusout-prevented",f),f.defaultPrevented||(n.preventDefault(),$&&l(A,!0))}else if(G&&[A,C].includes(m)){const f=L({focusReason:c.value});o("focusout-prevented",f),f.defaultPrevented||(n.preventDefault(),$&&l(R,!0))}}else if(m===C){const f=L({focusReason:c.value});o("focusout-prevented",f),f.defaultPrevented||n.preventDefault()}}};ie(me,{focusTrapRef:t,onKeydown:T}),O(()=>e.focusTrapEl,n=>{n&&(t.value=n)},{immediate:!0}),O([t],([n],[u])=>{n&&(n.addEventListener("keydown",T),n.addEventListener("focusin",B),n.addEventListener("focusout",M)),u&&(u.removeEventListener("keydown",T),u.removeEventListener("focusin",B),u.removeEventListener("focusout",M))});const H=n=>{o(J,n)},Y=n=>o(z,n),B=n=>{const u=S(t);if(!u)return;const i=n.target,a=n.relatedTarget,d=i&&u.contains(i);e.trapped||a&&u.contains(a)||(s=a),d&&o("focusin",n),!E.paused&&e.trapped&&(d?r=i:l(r,!0))},M=n=>{const u=S(t);if(!(E.paused||!u))if(e.trapped){const i=n.relatedTarget;!ae(i)&&!u.contains(i)&&setTimeout(()=>{if(!E.paused&&e.trapped){const a=L({focusReason:c.value});o("focusout-prevented",a),a.defaultPrevented||l(r,!0)}},0)}else{const i=n.target;i&&u.contains(i)||o("focusout",n)}};async function x(){await j();const n=S(t);if(n){ee.push(E);const u=n.contains(document.activeElement)?s:document.activeElement;if(s=u,!n.contains(u)){const a=new Event(D,X);n.addEventListener(D,H),n.dispatchEvent(a),a.defaultPrevented||j(()=>{let d=e.focusStartEl;fe(d)||(l(d),document.activeElement!==d&&(d="first")),d==="first"&&Le(oe(n),!0),(document.activeElement===u||d==="container")&&l(n)})}}}function V(){const n=S(t);if(n){n.removeEventListener(D,H);const u=new CustomEvent(U,{...X,detail:{focusReason:c.value}});n.addEventListener(U,Y),n.dispatchEvent(u),!u.defaultPrevented&&(c.value=="keyboard"||!be()||n.contains(document.activeElement))&&l(s??document.body),n.removeEventListener(U,Y),ee.remove(E)}}return k(()=>{e.trapped&&x(),O(()=>e.trapped,n=>{n?x():V()})}),K(()=>{e.trapped&&V()}),{onKeydown:T}}});function Ae(e,o,t,s,r,c){return de(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ue=ue(Ce,[["render",Ae],["__file","focus-trap.vue"]]);export{Ue as E,me as F,Ee as P,De as a,I as f,Ie as g,Oe as i};
